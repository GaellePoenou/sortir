{% extends 'base.html.twig' %}

{% block title %}Création sortie{% endblock %}

{% block body %}

    <h1 class="display-5 my-3 text-center">Créer une sortie</h1>

    <div>

        {{ form_start(sortieForm) }}

        <div class="row mt-3">

            <div class="col-4 mx-auto">
                {{ form_row(sortieForm.nom) }}
                {{ form_row(sortieForm.dateHeureDebut) }}
                {{ form_row(sortieForm.dateLimiteInscription) }}
                {{ form_row(sortieForm.nbInscriptionsMax) }}
                {{ form_row(sortieForm.duree) }}
                {{ form_row(sortieForm.infosSortie) }}
           </div>

            <div class="col-4 mx-auto">
                {{ form_row(sortieForm.campus) }}
                {{ form_row(sortieForm.ville) }}
                {{ form_row(sortieForm.lieu) }}
                {{ form_row(sortieForm.rue) }}
                {{ form_row(sortieForm.codePostal) }}
                {{ form_row(sortieForm.latitude) }}
                {{ form_row(sortieForm.longitude) }}
            </div>

        </div>

        <div class="col-4 mx-auto my-3">
            <button type="submit" class="btn btn-primary w-25" formnovalidate>Enregistrer</button>
        </div>

        {{ form_end(sortieForm) }}

    </div>

{% endblock %}

{% block javascript %}

    <script>

        window.onload = () => {
            //chargement de la liste des lieux lors du choix d'une ville
            let ville =document.querySelector("#sortie_ville");
            ville.addEventListener("change", function(){
                let form = this.closest("form");
                let data = this.name + "=" + this.value;
                fetch( form.action, {
                    method: form.getAttribute("method"),
                    body: data,
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded;" +
                        "charset: utf-8"
                    }
                })
                .then(response => response.text())
                .then(html => {
                    let content = document.createElement("html");
                    content.innerHTML = html;
                    let nouveauSelect = content.querySelector("#sortie_lieu");
                    document.querySelector("#sortie_lieu").replaceWith(nouveauSelect);
                })
                .catch(error => {
                    console.log(error);
                })
            });

                //chargement des propriétés du lieu choisi par l'utilisateur
                let lieu = document.querySelector("#s");
                lieu.addEventListener("change", function(){
                fetch( "https://127.0.0.1:8000/sortie/", {

            })
                .then()
                .catch(error => {
                console.log(error);
            })
            });

        }

    </script>

{% endblock %}
